name: Flutter build (at least one)

on:
  pull_request:

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Flutter„ÇíÂÖ•„Çå„ÇãÔºàfvm„Åß„Éê„Éº„Ç∏„Éß„É≥ÁÆ°ÁêÜ„Åó„Åü„Åè„Å¶„ÇÇ„ÄÅÂúüÂè∞„ÅØÂøÖË¶ÅÔºâ
      - name: Install Flutter
        uses: subosito/flutter-action@v2
        with:
            flutter-version: 'stable'   # „Å®„Çä„ÅÇ„Åà„Åöstable„ÄÇfvmÂÅ¥„ÅßÂà•„Éê„Éº„Ç∏„Éß„É≥„ÇíÂÖ•„Çå„Çã„Å™„Çâ„Åì„Åì„ÅØ‰Ωï„Åß„ÇÇOK
            cache: true

      # fvm „Çí pub „Åã„ÇâÂÖ•„Çå„ÇãÔºàbrew„Åò„ÇÉ„Å™„Åè„Å¶„Åì„ÇåÔºâ
      - name: Install fvm
        run: |
          dart pub global activate fvm
          echo "$HOME/.pub-cache/bin" >> $GITHUB_PATH

      # „Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆ .fvmrc „ÇíÂÖÉ„Å´Flutter„ÇíÂÖ•„Çå„Çã
      - name: Setup flutter via fvm
        run: |
          fvm install
          fvm flutter --version
          fvm flutter pub get

      - name: Build apk or ios
        run: |
          set +e

          echo "=== Try Android (apk) build ==="
          fvm flutter build apk
          APK_STATUS=$?

          echo "=== Try iOS build (no codesign) ==="
          fvm flutter build ios --no-codesign
          IOS_STATUS=$?

          echo "Android build exit code: $APK_STATUS"
          echo "iOS build exit code: $IOS_STATUS"

          if [ $APK_STATUS -ne 0 ] && [ $IOS_STATUS -ne 0 ]; then
            echo "Both Flutter builds failed."
            exit 1
          fi

          echo "At least one build succeeded üéâ"
